package de.grundid.dienstleister.azh;

import static org.junit.Assert.assertEquals;

import java.util.regex.Matcher;
import java.util.regex.Pattern;

import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.nodes.Element;
import org.jsoup.select.Elements;
import org.junit.Test;

import de.grundid.dienstleister.ServiceProvider;
import de.grundid.utils.GrabUtils;

public class DetailScraper {

	private static final Pattern ZIP_CITY_PATTERN = Pattern.compile(".*(\\d\\d\\d\\d\\d)(.*)");
	private static final Pattern PHONE_PATTERN = Pattern.compile(".*unter der Rufnummer(.*)sowie in der Branche.*");
	private static final String TABLE = "<table width=\"490\" border=\"0\" cellspacing=\"0\" cellpadding=\"5\" class=\"table_v1\" style=\"margin-top:2px;\">\n"
			+ "  <tbody><tr>\n"
			+ "    <td align=\"center\" style=\"padding:15px;\"><div style=\"vertical-align:middle; height:17px;\" class=\"txt_marked_head_b\"><img src=\"/hz_img/star.png\" align=\"absmiddle\" style=\"padding-right:15px;\">ANBIETER INFORMATIONEN<img src=\"/hz_img/star.png\" align=\"absmiddle\" style=\"padding-left:15px;\"></div></td>\n"
			+ "  </tr>\n"
			+ "  <tr>\n"
			+ "    <td style=\"padding-left:15px;\" align=\"left\"><font class=\"txt_marked_head_b\">Reisebüro Blumenberg</font><br><b>Anke Blumenberg</b><br> aus <a href=\"/Hochzeitsreise_in_Hamburg\" class=\"txt_marked_big\">Hamburg</a><br><br>"
			+ "<b>Adresse</b><br><span class=\"txt_marked_big\">Rotdornstieg 3</span><br>"
			+ "<span class=\"txt_marked_big_b\">DE&nbsp;-&nbsp;22297 Hamburg</span><br><br><b>Kontakt</b>"
			+ "<br>Telefon › <a href=\"?showData=phone\" rel=\"nofollow\" class=\"txt_marked_b\">Telefonnummer anzeigen</a><br>E-Mail ›&nbsp;"
			+ "<a href=\"#\" onfocus=\"if(this.blur)this.blur()\" class=\"txt_marked_big\" onclick=\"encodeEmail('ly;}qV}98jWWmPZ^Bs}j','%0D%17P%1814%11LU%0F9%25%089%29%3B%2C%5D%19%0F','Kontaktanfrage über Alles zur Hochzeit')\">E-Mail senden</a>"
			+ "<br>Homepage › <a href=\"http://www.blumenreisen.de\" target=\"_blank\" rel=\"nofollow\" class=\"txt_marked_head\">www.blumenreisen.de</a><div style=\"display:inline; padding:0px; margin:0px;\">\n"
			+ "<div style=\"margin-bottom:10px;\"><!-- BEGIN_advertise_3 --> \n"
			+ "\n"
			+ "\n"
			+ "\n"
			+ " <!-- END_advertise_4 --></div>\n"
			+ "\n"
			+ "</td>\n"
			+ "  </tr>\n"
			+ "  <tr>\n"
			+ "    <td height=\"15\" align=\"center\"></td>\n" + "  </tr>    \n" + "</tbody></table>";
	private static final String TABLE2 = "<table width=\"490\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">\n"
			+ "  <tbody><tr>\n"
			+ "    <td style=\"padding:2px;\" class=\"txt_norm_small\">Sind Sie Reisebüro Blumenberg aus 22297 Hamburg und unter der Rufnummer +49 (0) 40/5118051 sowie in der Branche Hochzeitsreise Hamburg bei uns gelistet? Dann prüfen Sie bitte, ob diese hier vom 16.02.2007 und bereits 6 mal direkt eingeblendeten Informationen korrekt sind oder ob eine Änderung/Löschung von uns durchgeführt werden soll. Bei Änderungswünschen mailen/schreiben Sie uns bitte, mit Angabe der Eintragsnummer (269164). Beachten Sie, dass bei Änderungs - bzw. Löschungswünschen, wo uns keine Eintragsnummer (269164) mitgeteilt wurde, sich die Bearbeitungzeit verlängert.&nbsp;&nbsp;›&nbsp;<a href=\"#\" onfocus=\"if(this.blur)this.blur()\" class=\"\" onclick=\"encodeEmail('hj7ccW}JqIe=1WLrqped=1W}Ul','%01%04Q%0C%236%11%26%14%3AHGD%25a%1A%1E%13%0D%1EXX%23S1%09','Datenanpassung: Reisebüro Blumenberg in Hamburg, ID: 269164')\">Bitte kontaktieren Sie uns per E-Mail</a>.</td>\n"
			+ "  </tr>\n"
			+ "  <tr>\n"
			+ "    <td align=\"center\" style=\"padding:10px; padding-bottom:5px;\" class=\"txt_marked_big\">Kartenansicht <b>Reisebüro Blumenberg</b><br>Hochzeitsreise in Hamburg</td>\n"
			+ "  </tr>\n"
			+ "  <tr>\n"
			+ "    <td>\n"
			+ "									<div id=\"map\" style=\"width: 490px; height: 350px; overflow: hidden; position: relative; -webkit-transform: translateZ(0px); background-color: rgb(229, 227, 223);\"><div></div><div></div><div class=\"gm-style\" style=\"position: absolute; left: 0px; top: 0px; overflow: hidden; width: 100%; height: 100%; z-index: 0;\"><div style=\"position: absolute; left: 0px; top: 0px; overflow: hidden; width: 100%; height: 100%; z-index: 0;\"><div style=\"position: absolute; left: 0px; top: 0px; z-index: 1; width: 100%; cursor: url(http://maps.gstatic.com/mapfiles/openhand_8_8.cur) 8 8, default; -webkit-transform-origin: 0px 0px; -webkit-transform: matrix(1, 0, 0, 1, 0, 0);\"><div style=\"-webkit-transform: translateZ(0px); position: absolute; left: 0px; top: 0px; width: 100%; z-index: 200;\"><div style=\"-webkit-transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 101; width: 100%;\"><div style=\"position: absolute; top: 0px; left: 0px;\"></div></div></div><div style=\"-webkit-transform: translateZ(0px); position: absolute; left: 0px; top: 0px; width: 100%; z-index: 201;\"><div style=\"-webkit-transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 102; width: 100%;\"><div style=\"position: absolute; top: 0px; left: 0px;\"></div></div><div style=\"-webkit-transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 103; width: 100%;\"><div style=\"position: absolute; top: 0px; left: 0px;\"></div><div style=\"position: absolute; left: 0px; top: 0px; z-index: -1;\"><div style=\"position: absolute; left: 0px; top: 0px; z-index: 1;\"><div style=\"width: 256px; height: 256px; overflow: hidden; -webkit-transform: translateZ(0px); position: absolute; left: -21px; top: 105px;\"></div><div style=\"width: 256px; height: 256px; overflow: hidden; -webkit-transform: translateZ(0px); position: absolute; left: 235px; top: 105px;\"></div><div style=\"width: 256px; height: 256px; overflow: hidden; -webkit-transform: translateZ(0px); position: absolute; left: 235px; top: -151px;\"></div><div style=\"width: 256px; height: 256px; overflow: hidden; -webkit-transform: translateZ(0px); position: absolute; left: -21px; top: -151px;\"></div><div style=\"width: 256px; height: 256px; overflow: hidden; -webkit-transform: translateZ(0px); position: absolute; left: -21px; top: 361px;\"></div><div style=\"width: 256px; height: 256px; overflow: hidden; -webkit-transform: translateZ(0px); position: absolute; left: 235px; top: 361px;\"></div><div style=\"width: 256px; height: 256px; overflow: hidden; -webkit-transform: translateZ(0px); position: absolute; left: -277px; top: 105px;\"></div><div style=\"width: 256px; height: 256px; overflow: hidden; -webkit-transform: translateZ(0px); position: absolute; left: 491px; top: 105px;\"></div><div style=\"width: 256px; height: 256px; overflow: hidden; -webkit-transform: translateZ(0px); position: absolute; left: -277px; top: 361px;\"></div><div style=\"width: 256px; height: 256px; overflow: hidden; -webkit-transform: translateZ(0px); position: absolute; left: 491px; top: -151px;\"></div><div style=\"width: 256px; height: 256px; overflow: hidden; -webkit-transform: translateZ(0px); position: absolute; left: -277px; top: -151px;\"></div><div style=\"width: 256px; height: 256px; overflow: hidden; -webkit-transform: translateZ(0px); position: absolute; left: 491px; top: 361px;\"></div></div></div><div style=\"width: 20px; height: 34px; overflow: hidden; position: absolute; left: 235px; top: 141px; z-index: 175;\"><img src=\"//maps.gstatic.com/mapfiles/markers2/marker.png\" draggable=\"false\" style=\"position: absolute; left: 0px; top: 0px; width: 20px; height: 34px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;\"></div></div></div><div style=\"-webkit-transform: translateZ(0px); position: absolute; left: 0px; top: 0px; width: 100%; z-index: 202;\"><div style=\"-webkit-transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 104; width: 100%;\"><div style=\"position: absolute; top: 0px; left: 0px;\"></div></div><div style=\"-webkit-transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 105; width: 100%;\"><div style=\"position: absolute; top: 0px; left: 0px;\"></div><div class=\"gmnoprint\" style=\"width: 20px; height: 34px; overflow: hidden; position: absolute; opacity: 0.01; left: 235px; top: 141px; z-index: 175;\"><img src=\"//maps.gstatic.com/mapfiles/markers2/marker.png\" draggable=\"false\" usemap=\"#gmimap0\" style=\"position: absolute; left: 0px; top: 0px; width: 20px; height: 34px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;\"><map name=\"gmimap0\" id=\"gmimap0\"><area href=\"javascript:void(0)\" log=\"miw\" coords=\"9,0,6,1,4,2,2,4,0,8,0,12,1,14,2,16,5,19,7,23,8,26,9,30,9,34,11,34,11,30,12,26,13,24,14,21,16,18,18,16,20,12,20,8,18,4,16,2,15,1,13,0\" shape=\"poly\" title=\"\" style=\"cursor: pointer;\"></map></div></div><div style=\"-webkit-transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 106; width: 100%;\"><div style=\"position: absolute; top: 0px; left: 0px;\"></div></div></div><div style=\"-webkit-transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 100; width: 100%;\"><div style=\"position: absolute; top: 0px; left: 0px;\"></div><div style=\"position: absolute; left: 0px; top: 0px; z-index: 0;\"><div style=\"position: absolute; left: 0px; top: 0px; z-index: 1;\"><div style=\"width: 256px; height: 256px; -webkit-transform: translateZ(0px); position: absolute; left: -21px; top: 105px;\"></div><div style=\"width: 256px; height: 256px; -webkit-transform: translateZ(0px); position: absolute; left: 235px; top: 105px;\"></div><div style=\"width: 256px; height: 256px; -webkit-transform: translateZ(0px); position: absolute; left: 235px; top: -151px;\"></div><div style=\"width: 256px; height: 256px; -webkit-transform: translateZ(0px); position: absolute; left: -21px; top: -151px;\"></div><div style=\"width: 256px; height: 256px; -webkit-transform: translateZ(0px); position: absolute; left: -21px; top: 361px;\"></div><div style=\"width: 256px; height: 256px; -webkit-transform: translateZ(0px); position: absolute; left: 235px; top: 361px;\"></div><div style=\"width: 256px; height: 256px; -webkit-transform: translateZ(0px); position: absolute; left: -277px; top: 105px;\"></div><div style=\"width: 256px; height: 256px; -webkit-transform: translateZ(0px); position: absolute; left: 491px; top: 105px;\"></div><div style=\"width: 256px; height: 256px; -webkit-transform: translateZ(0px); position: absolute; left: -277px; top: 361px;\"></div><div style=\"width: 256px; height: 256px; -webkit-transform: translateZ(0px); position: absolute; left: 491px; top: -151px;\"></div><div style=\"width: 256px; height: 256px; -webkit-transform: translateZ(0px); position: absolute; left: -277px; top: -151px;\"></div><div style=\"width: 256px; height: 256px; -webkit-transform: translateZ(0px); position: absolute; left: 491px; top: 361px;\"></div></div></div></div><div style=\"position: absolute; z-index: 0; left: 0px; top: 0px;\"><div style=\"overflow: hidden; width: 490px; height: 350px;\"><img src=\"http://maps.googleapis.com/maps/api/js/StaticMapService.GetMapImage?1m2&amp;1i1106709&amp;2i677015&amp;2e2&amp;3u13&amp;4m2&amp;1u490&amp;2u350&amp;5m4&amp;1e3&amp;5sde-DE&amp;6sus&amp;10b1&amp;token=73915\" style=\"width: 490px; height: 350px;\"></div></div><div style=\"position: absolute; left: 0px; top: 0px; z-index: 0;\"><div style=\"position: absolute; left: 0px; top: 0px; z-index: 1;\"><div style=\"width: 256px; height: 256px; -webkit-transform: translateZ(0px); position: absolute; left: -21px; top: 105px; opacity: 1; transition: opacity 200ms ease-out; -webkit-transition: opacity 200ms ease-out;\"><img src=\"http://khm1.googleapis.com/kh?v=152&amp;hl=de-DE&amp;x=4323&amp;y=2645&amp;z=13&amp;token=96990\" draggable=\"false\" style=\"width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; position: absolute; left: 0px; top: 0px;\"><img src=\"http://mt1.googleapis.com/vt?lyrs=m@266000000&amp;src=apiv3&amp;hl=de-DE&amp;x=4323&amp;y=2645&amp;z=13&amp;style=50,37%7Csmartmaps\" draggable=\"false\" style=\"width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; position: absolute; left: 0px; top: 0px;\"></div><div style=\"width: 256px; height: 256px; -webkit-transform: translateZ(0px); position: absolute; left: 235px; top: -151px; opacity: 1; transition: opacity 200ms ease-out; -webkit-transition: opacity 200ms ease-out;\"><img src=\"http://khm0.googleapis.com/kh?v=152&amp;hl=de-DE&amp;x=4324&amp;y=2644&amp;z=13&amp;token=118390\" draggable=\"false\" style=\"width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; position: absolute; left: 0px; top: 0px;\"><img src=\"http://mt0.googleapis.com/vt?lyrs=m@266070558&amp;src=apiv3&amp;hl=de-DE&amp;x=4324&amp;y=2644&amp;z=13&amp;style=50,37%7Csmartmaps\" draggable=\"false\" style=\"width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; position: absolute; left: 0px; top: 0px;\"></div><div style=\"width: 256px; height: 256px; -webkit-transform: translateZ(0px); position: absolute; left: 235px; top: 105px; opacity: 1; transition: opacity 200ms ease-out; -webkit-transition: opacity 200ms ease-out;\"><img src=\"http://khm0.googleapis.com/kh?v=152&amp;hl=de-DE&amp;x=4324&amp;y=2645&amp;z=13&amp;token=34475\" draggable=\"false\" style=\"width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; position: absolute; left: 0px; top: 0px;\"><img src=\"http://mt0.googleapis.com/vt?lyrs=m@266000000&amp;src=apiv3&amp;hl=de-DE&amp;x=4324&amp;y=2645&amp;z=13&amp;style=50,37%7Csmartmaps\" draggable=\"false\" style=\"width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; position: absolute; left: 0px; top: 0px;\"></div><div style=\"width: 256px; height: 256px; -webkit-transform: translateZ(0px); position: absolute; left: -21px; top: -151px; opacity: 1; transition: opacity 200ms ease-out; -webkit-transition: opacity 200ms ease-out;\"><img src=\"http://khm1.googleapis.com/kh?v=152&amp;hl=de-DE&amp;x=4323&amp;y=2644&amp;z=13&amp;token=49834\" draggable=\"false\" style=\"width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; position: absolute; left: 0px; top: 0px;\"><img src=\"http://mt1.googleapis.com/vt?lyrs=m@266000000&amp;src=apiv3&amp;hl=de-DE&amp;x=4323&amp;y=2644&amp;z=13&amp;style=50,37%7Csmartmaps\" draggable=\"false\" style=\"width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; position: absolute; left: 0px; top: 0px;\"></div><div style=\"width: 256px; height: 256px; -webkit-transform: translateZ(0px); position: absolute; left: 491px; top: -151px; opacity: 1; transition: opacity 200ms ease-out; -webkit-transition: opacity 200ms ease-out;\"><img src=\"http://khm1.googleapis.com/kh?v=152&amp;hl=de-DE&amp;x=4325&amp;y=2644&amp;z=13&amp;token=55875\" draggable=\"false\" style=\"width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; position: absolute; left: 0px; top: 0px;\"><img src=\"http://mt1.googleapis.com/vt?lyrs=m@266000000&amp;src=apiv3&amp;hl=de-DE&amp;x=4325&amp;y=2644&amp;z=13&amp;style=50,37%7Csmartmaps\" draggable=\"false\" style=\"width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; position: absolute; left: 0px; top: 0px;\"></div><div style=\"width: 256px; height: 256px; -webkit-transform: translateZ(0px); position: absolute; left: -21px; top: 361px; opacity: 1; transition: opacity 200ms ease-out; -webkit-transition: opacity 200ms ease-out;\"><img src=\"http://khm1.googleapis.com/kh?v=152&amp;hl=de-DE&amp;x=4323&amp;y=2646&amp;z=13&amp;token=13075\" draggable=\"false\" style=\"width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; position: absolute; left: 0px; top: 0px;\"><img src=\"http://mt1.googleapis.com/vt?lyrs=m@266106532&amp;src=apiv3&amp;hl=de-DE&amp;x=4323&amp;y=2646&amp;z=13&amp;style=50,37%7Csmartmaps\" draggable=\"false\" style=\"width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; position: absolute; left: 0px; top: 0px;\"></div><div style=\"width: 256px; height: 256px; -webkit-transform: translateZ(0px); position: absolute; left: -277px; top: -151px; opacity: 1; transition: opacity 200ms ease-out; -webkit-transition: opacity 200ms ease-out;\"><img src=\"http://khm0.googleapis.com/kh?v=152&amp;hl=de-DE&amp;x=4322&amp;y=2644&amp;z=13&amp;token=112349\" draggable=\"false\" style=\"width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; position: absolute; left: 0px; top: 0px;\"><img src=\"http://mt0.googleapis.com/vt?lyrs=m@266000000&amp;src=apiv3&amp;hl=de-DE&amp;x=4322&amp;y=2644&amp;z=13&amp;style=50,37%7Csmartmaps\" draggable=\"false\" style=\"width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; position: absolute; left: 0px; top: 0px;\"></div><div style=\"width: 256px; height: 256px; -webkit-transform: translateZ(0px); position: absolute; left: 491px; top: 105px; opacity: 1; transition: opacity 200ms ease-out; -webkit-transition: opacity 200ms ease-out;\"><img src=\"http://khm1.googleapis.com/kh?v=152&amp;hl=de-DE&amp;x=4325&amp;y=2645&amp;z=13&amp;token=103031\" draggable=\"false\" style=\"width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; position: absolute; left: 0px; top: 0px;\"><img src=\"http://mt1.googleapis.com/vt?lyrs=m@266091151&amp;src=apiv3&amp;hl=de-DE&amp;x=4325&amp;y=2645&amp;z=13&amp;style=50,37%7Csmartmaps\" draggable=\"false\" style=\"width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; position: absolute; left: 0px; top: 0px;\"></div><div style=\"width: 256px; height: 256px; -webkit-transform: translateZ(0px); position: absolute; left: 235px; top: 361px; opacity: 1; transition: opacity 200ms ease-out; -webkit-transition: opacity 200ms ease-out;\"><img src=\"http://khm0.googleapis.com/kh?v=152&amp;hl=de-DE&amp;x=4324&amp;y=2646&amp;z=13&amp;token=81631\" draggable=\"false\" style=\"width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; position: absolute; left: 0px; top: 0px;\"><img src=\"http://mt0.googleapis.com/vt?lyrs=m@266111592&amp;src=apiv3&amp;hl=de-DE&amp;x=4324&amp;y=2646&amp;z=13&amp;style=50,37%7Csmartmaps\" draggable=\"false\" style=\"width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; position: absolute; left: 0px; top: 0px;\"></div><div style=\"width: 256px; height: 256px; -webkit-transform: translateZ(0px); position: absolute; left: -277px; top: 105px; opacity: 1; transition: opacity 200ms ease-out; -webkit-transition: opacity 200ms ease-out;\"><img src=\"http://khm0.googleapis.com/kh?v=152&amp;hl=de-DE&amp;x=4322&amp;y=2645&amp;z=13&amp;token=28434\" draggable=\"false\" style=\"width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; position: absolute; left: 0px; top: 0px;\"><img src=\"http://mt0.googleapis.com/vt?lyrs=m@266097022&amp;src=apiv3&amp;hl=de-DE&amp;x=4322&amp;y=2645&amp;z=13&amp;style=50,37%7Csmartmaps\" draggable=\"false\" style=\"width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; position: absolute; left: 0px; top: 0px;\"></div><div style=\"width: 256px; height: 256px; -webkit-transform: translateZ(0px); position: absolute; left: 491px; top: 361px; opacity: 1; transition: opacity 200ms ease-out; -webkit-transition: opacity 200ms ease-out;\"><img src=\"http://khm1.googleapis.com/kh?v=152&amp;hl=de-DE&amp;x=4325&amp;y=2646&amp;z=13&amp;token=19116\" draggable=\"false\" style=\"width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; position: absolute; left: 0px; top: 0px;\"><img src=\"http://mt1.googleapis.com/vt?lyrs=m@266113736&amp;src=apiv3&amp;hl=de-DE&amp;x=4325&amp;y=2646&amp;z=13&amp;style=50,37%7Csmartmaps\" draggable=\"false\" style=\"width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; position: absolute; left: 0px; top: 0px;\"></div><div style=\"width: 256px; height: 256px; -webkit-transform: translateZ(0px); position: absolute; left: -277px; top: 361px; opacity: 1; transition: opacity 200ms ease-out; -webkit-transition: opacity 200ms ease-out;\"><img src=\"http://khm0.googleapis.com/kh?v=152&amp;hl=de-DE&amp;x=4322&amp;y=2646&amp;z=13&amp;token=75590\" draggable=\"false\" style=\"width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; position: absolute; left: 0px; top: 0px;\"><img src=\"http://mt0.googleapis.com/vt?lyrs=m@266106532&amp;src=apiv3&amp;hl=de-DE&amp;x=4322&amp;y=2646&amp;z=13&amp;style=50,37%7Csmartmaps\" draggable=\"false\" style=\"width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; position: absolute; left: 0px; top: 0px;\"></div></div></div></div></div><div style=\"margin-left: 5px; margin-right: 5px; z-index: 1000000; position: absolute; left: 0px; bottom: 0px;\"><a target=\"_blank\" href=\"http://maps.google.com/maps?ll=53.611409,10.021235&amp;z=13&amp;t=h&amp;hl=de-DE&amp;gl=US&amp;mapclient=apiv3\" title=\"Klicken, um diese Region in Google Maps anzuzeigen\" style=\"position: static; overflow: visible; float: none; display: inline;\"><div style=\"width: 62px; height: 26px; cursor: pointer;\"><img src=\"http://maps.gstatic.com/mapfiles/api-3/images/google_white2.png\" draggable=\"false\" style=\"position: absolute; left: 0px; top: 0px; width: 62px; height: 26px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;\"></div></a></div><div class=\"gmnoprint\" style=\"z-index: 1000001; position: absolute; right: 271px; bottom: 0px; width: 65px;\"><div draggable=\"false\" class=\"gm-style-cc\" style=\"-webkit-user-select: none;\"><div style=\"opacity: 0.7; width: 100%; height: 100%; position: absolute;\"><div style=\"width: 1px;\"></div><div style=\"width: auto; height: 100%; margin-left: 1px; background-color: rgb(245, 245, 245);\"></div></div><div style=\"position: relative; padding-right: 6px; padding-left: 6px; font-family: Roboto, Arial, sans-serif; font-size: 10px; color: rgb(68, 68, 68); white-space: nowrap; direction: ltr; text-align: right;\"><a style=\"color: rgb(68, 68, 68); text-decoration: none; cursor: pointer;\">Kartendaten</a><span style=\"display: none;\">Kartendaten © 2014 GeoBasis-DE/BKG (©2009), Google  Grafiken © 2014 , DigitalGlobe, GeoBasis-DE/BKG, GeoContent, Landsat</span></div></div></div><div style=\"padding: 15px 21px; border: 1px solid rgb(171, 171, 171); font-family: Roboto, Arial, sans-serif; color: rgb(34, 34, 34); -webkit-box-shadow: rgba(0, 0, 0, 0.2) 0px 4px 16px; box-shadow: rgba(0, 0, 0, 0.2) 0px 4px 16px; z-index: 10000002; display: none; width: 256px; height: 148px; position: absolute; left: 95px; top: 85px; background-color: white;\"><div style=\"padding: 0px 0px 10px; font-size: 16px;\">Kartendaten</div><div style=\"font-size: 13px;\">Kartendaten © 2014 GeoBasis-DE/BKG (©2009), Google  Grafiken © 2014 , DigitalGlobe, GeoBasis-DE/BKG, GeoContent, Landsat</div><div style=\"width: 13px; height: 13px; overflow: hidden; position: absolute; opacity: 0.7; right: 12px; top: 12px; z-index: 10000; cursor: pointer;\"><img src=\"http://maps.gstatic.com/mapfiles/api-3/images/mapcnt3.png\" draggable=\"false\" style=\"position: absolute; left: -2px; top: -336px; width: 59px; height: 492px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;\"></div></div><div class=\"gmnoscreen\" style=\"position: absolute; right: 0px; bottom: 0px;\"><div style=\"font-family: Roboto, Arial, sans-serif; font-size: 11px; color: rgb(68, 68, 68); direction: ltr; text-align: right; background-color: rgb(245, 245, 245);\">Kartendaten © 2014 GeoBasis-DE/BKG (©2009), Google  Grafiken © 2014 , DigitalGlobe, GeoBasis-DE/BKG, GeoContent, Landsat</div></div><div class=\"gmnoprint gm-style-cc\" draggable=\"false\" style=\"z-index: 1000001; position: absolute; -webkit-user-select: none; right: 154px; bottom: 0px;\"><div style=\"opacity: 0.7; width: 100%; height: 100%; position: absolute;\"><div style=\"width: 1px;\"></div><div style=\"width: auto; height: 100%; margin-left: 1px; background-color: rgb(245, 245, 245);\"></div></div><div style=\"position: relative; padding-right: 6px; padding-left: 6px; font-family: Roboto, Arial, sans-serif; font-size: 10px; color: rgb(68, 68, 68); white-space: nowrap; direction: ltr; text-align: right;\"><a href=\"http://www.google.com/intl/de-DE_US/help/terms_maps.html\" target=\"_blank\" style=\"text-decoration: none; cursor: pointer; color: rgb(68, 68, 68);\">Nutzungsbedingungen</a></div></div><div draggable=\"false\" class=\"gm-style-cc\" style=\"-webkit-user-select: none; position: absolute; right: 0px; bottom: 0px;\"><div style=\"opacity: 0.7; width: 100%; height: 100%; position: absolute;\"><div style=\"width: 1px;\"></div><div style=\"width: auto; height: 100%; margin-left: 1px; background-color: rgb(245, 245, 245);\"></div></div><div style=\"position: relative; padding-right: 6px; padding-left: 6px; font-family: Roboto, Arial, sans-serif; font-size: 10px; color: rgb(68, 68, 68); white-space: nowrap; direction: ltr; text-align: right;\"><a target=\"_new\" title=\"Google falsche Straßenkarte oder Bilder melden\" href=\"http://maps.google.com/maps?ll=53.611409,10.021235&amp;z=13&amp;t=h&amp;hl=de-DE&amp;gl=US&amp;mapclient=apiv3&amp;skstate=action:mps_dialog$apiref:1&amp;output=classic\" style=\"font-family: Roboto, Arial, sans-serif; font-size: 10px; color: rgb(68, 68, 68); text-decoration: none; position: relative;\">Fehler bei Google Maps melden</a></div></div><div class=\"gmnoprint\" draggable=\"false\" controlwidth=\"32\" controlheight=\"84\" style=\"margin: 5px; -webkit-user-select: none; position: absolute; left: 0px; top: 0px;\"><div controlwidth=\"32\" controlheight=\"40\" style=\"cursor: url(http://maps.gstatic.com/mapfiles/openhand_8_8.cur) 8 8, default; position: absolute; left: 0px; top: 0px;\"><div style=\"width: 32px; height: 40px; overflow: hidden; position: absolute; left: 0px; top: 0px;\"><img src=\"http://maps.gstatic.com/mapfiles/api-3/images/cb_scout2.png\" draggable=\"false\" style=\"position: absolute; left: -9px; top: -102px; width: 1028px; height: 214px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;\"></div><div style=\"width: 32px; height: 40px; overflow: hidden; position: absolute; left: 0px; top: 0px; visibility: hidden;\"><img src=\"http://maps.gstatic.com/mapfiles/api-3/images/cb_scout2.png\" draggable=\"false\" style=\"position: absolute; left: -107px; top: -102px; width: 1028px; height: 214px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;\"></div><div style=\"width: 32px; height: 40px; overflow: hidden; position: absolute; left: 0px; top: 0px; visibility: hidden;\"><img src=\"http://maps.gstatic.com/mapfiles/api-3/images/cb_scout2.png\" draggable=\"false\" style=\"position: absolute; left: -58px; top: -102px; width: 1028px; height: 214px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;\"></div><div style=\"width: 32px; height: 40px; overflow: hidden; position: absolute; left: 0px; top: 0px; visibility: hidden;\"><img src=\"http://maps.gstatic.com/mapfiles/api-3/images/cb_scout2.png\" draggable=\"false\" style=\"position: absolute; left: -205px; top: -102px; width: 1028px; height: 214px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;\"></div></div><div class=\"gmnoprint\" controlwidth=\"0\" controlheight=\"0\" style=\"opacity: 0.6; display: none; position: absolute;\"><div title=\"Karte um 90&nbsp;Grad drehen\" style=\"width: 22px; height: 22px; overflow: hidden; position: absolute; cursor: pointer;\"><img src=\"http://maps.gstatic.com/mapfiles/api-3/images/mapcnt3.png\" draggable=\"false\" style=\"position: absolute; left: -38px; top: -360px; width: 59px; height: 492px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;\"></div></div><div class=\"gmnoprint\" controlwidth=\"20\" controlheight=\"39\" style=\"position: absolute; left: 6px; top: 45px;\"><div style=\"width: 20px; height: 39px; overflow: hidden; position: absolute;\"><img src=\"http://maps.gstatic.com/mapfiles/api-3/images/mapcnt3.png\" draggable=\"false\" style=\"position: absolute; left: -39px; top: -401px; width: 59px; height: 492px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;\"></div><div title=\"Vergrößern\" style=\"position: absolute; left: 0px; top: 2px; width: 20px; height: 17px; cursor: pointer;\"></div><div title=\"Verkleinern\" style=\"position: absolute; left: 0px; top: 19px; width: 20px; height: 17px; cursor: pointer;\"></div></div></div><div class=\"gmnoprint\" style=\"margin: 5px; z-index: 0; position: absolute; cursor: pointer; right: 0px; top: 0px;\"><div class=\"gm-style-mtc\" style=\"float: left;\"><div draggable=\"false\" title=\"Stadtplan anzeigen\" style=\"direction: ltr; overflow: hidden; text-align: center; position: relative; color: rgb(86, 86, 86); font-family: Roboto, Arial, sans-serif; -webkit-user-select: none; font-size: 11px; padding: 1px 6px; border-bottom-left-radius: 2px; border-top-left-radius: 2px; -webkit-background-clip: padding-box; border: 1px solid rgba(0, 0, 0, 0.14902); -webkit-box-shadow: rgba(0, 0, 0, 0.298039) 0px 1px 4px -1px; box-shadow: rgba(0, 0, 0, 0.298039) 0px 1px 4px -1px; min-width: 28px; background-color: rgb(255, 255, 255); background-clip: padding-box;\">Karte</div></div><div class=\"gm-style-mtc\" style=\"float: left;\"><div draggable=\"false\" title=\"Satellitenbilder anzeigen\" style=\"direction: ltr; overflow: hidden; text-align: center; position: relative; color: rgb(0, 0, 0); font-family: Roboto, Arial, sans-serif; -webkit-user-select: none; font-size: 11px; padding: 1px 6px; border-bottom-right-radius: 2px; border-top-right-radius: 2px; -webkit-background-clip: padding-box; border-width: 1px 1px 1px 0px; border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-top-color: rgba(0, 0, 0, 0.14902); border-right-color: rgba(0, 0, 0, 0.14902); border-bottom-color: rgba(0, 0, 0, 0.14902); -webkit-box-shadow: rgba(0, 0, 0, 0.298039) 0px 1px 4px -1px; box-shadow: rgba(0, 0, 0, 0.298039) 0px 1px 4px -1px; min-width: 32px; font-weight: 500; background-color: rgb(255, 255, 255); background-clip: padding-box;\">Satellit</div><div style=\"z-index: -1; padding-top: 2px; -webkit-background-clip: padding-box; border-width: 0px 1px 1px; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; border-right-color: rgba(0, 0, 0, 0.14902); border-bottom-color: rgba(0, 0, 0, 0.14902); border-left-color: rgba(0, 0, 0, 0.14902); -webkit-box-shadow: rgba(0, 0, 0, 0.298039) 0px 1px 4px -1px; box-shadow: rgba(0, 0, 0, 0.298039) 0px 1px 4px -1px; position: absolute; right: 0px; top: 19px; text-align: left; display: none; background-color: white; background-clip: padding-box;\"><div draggable=\"false\" title=\"Zoomen Sie heran, um die 45-Grad-Ansicht anzuzeigen.\" style=\"color: rgb(184, 184, 184); font-family: Roboto, Arial, sans-serif; -webkit-user-select: none; font-size: 11px; padding: 3px 8px 3px 3px; direction: ltr; text-align: left; white-space: nowrap; display: none; background-color: rgb(255, 255, 255);\"><span role=\"checkbox\" style=\"box-sizing: border-box; position: relative; line-height: 0; font-size: 0px; margin: 0px 5px 0px 0px; display: inline-block; border: 1px solid rgb(241, 241, 241); border-top-left-radius: 1px; border-top-right-radius: 1px; border-bottom-right-radius: 1px; border-bottom-left-radius: 1px; width: 13px; height: 13px; vertical-align: middle; background-color: rgb(255, 255, 255);\"><div style=\"position: absolute; left: 1px; top: -2px; width: 13px; height: 11px; overflow: hidden; display: none;\"><img src=\"http://maps.gstatic.com/mapfiles/mv/imgs8.png\" draggable=\"false\" style=\"position: absolute; left: -52px; top: -44px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; width: 68px; height: 67px;\"></div></span><label style=\"vertical-align: middle; cursor: pointer;\">45°</label></div><div draggable=\"false\" title=\"Satellitenbilder mit Straßennamen anzeigen\" style=\"color: rgb(0, 0, 0); font-family: Roboto, Arial, sans-serif; -webkit-user-select: none; font-size: 11px; padding: 3px 8px 3px 3px; direction: ltr; text-align: left; white-space: nowrap; background-color: rgb(255, 255, 255);\"><span role=\"checkbox\" style=\"box-sizing: border-box; position: relative; line-height: 0; font-size: 0px; margin: 0px 5px 0px 0px; display: inline-block; border: 1px solid rgb(198, 198, 198); border-top-left-radius: 1px; border-top-right-radius: 1px; border-bottom-right-radius: 1px; border-bottom-left-radius: 1px; width: 13px; height: 13px; vertical-align: middle; background-color: rgb(255, 255, 255);\"><div style=\"position: absolute; left: 1px; top: -2px; width: 13px; height: 11px; overflow: hidden;\"><img src=\"http://maps.gstatic.com/mapfiles/mv/imgs8.png\" draggable=\"false\" style=\"position: absolute; left: -52px; top: -44px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; width: 68px; height: 67px;\"></div></span><label style=\"vertical-align: middle; cursor: pointer;\">Beschriftungen</label></div></div></div></div></div></div>\n"
			+ "									<script type=\"text/javascript\">\n" + "									//<![CDATA[\n" + "									\n"
			+ "									var map = new GMap2(document.getElementById(\"map\"));\n"
			+ "									var geocoder = new GClientGeocoder();\n"
			+ "									geocoder.getLatLng(\"Rotdornstieg 3, 22297, Hamburg, Deutschland\",\n"
			+ "										function(point) {\n" + "												if (!point) {}\n" + "												else {\n"
			+ "												map.setCenter(point, 13, G_HYBRID_MAP);\n"
			+ "												var marker = new GMarker(point);\n" + "												map.addOverlay(marker);\n"
			+ "												}\n" + "										}\n" + "									);							\n"
			+ "									map.addControl(new GSmallMapControl());\n"
			+ "									map.addControl(new GMapTypeControl());\n" + "									//]]>\n" + "									</script>			\n"
			+ "					</td>\n" + "  </tr>\n" + "</tbody></table>";

	@Test
	public void itShouldPopulateData() throws Exception {
		Document document = Jsoup.parse(TABLE);
		Elements elementsByClass = document.getElementsByTag("table");
		ServiceProvider sp = new ServiceProvider();
		populateData(sp, elementsByClass.first());
		assertEquals("Reisebüro Blumenberg", sp.getName());
		assertEquals("Rotdornstieg 3", sp.getStreet());
		assertEquals("22297", sp.getZip());
		assertEquals("Hamburg", sp.getCity());
		assertEquals("http://www.blumenreisen.de", sp.getHomepage());
		assertEquals(
				"encodeEmail('ly;}qV}98jWWmPZ^Bs}j','%0D%17P%1814%11LU%0F9%25%089%29%3B%2C%5D%19%0F','Kontaktanfrage über Alles zur Hochzeit')",
				sp.getMail());
	}

	public static void populateData(ServiceProvider sp, Element element) {
		Element title = element.getElementsByTag("font").first();
		GrabUtils.setValue(title.text(), "name", sp);
		Elements siblingElements = title.siblingElements();
		for (Element sibling : siblingElements) {
			if (sibling.nodeName().equals("span")) {
				if (sibling.hasClass("txt_marked_big")) {
					GrabUtils.setValue(sibling.text(), "street", sp);
				}
				else if (sibling.hasClass("txt_marked_big_b")) {
					String value = sibling.text();
					Matcher matcher = ZIP_CITY_PATTERN.matcher(value);
					if (matcher.matches()) {
						GrabUtils.setValue(matcher.group(1), "zip", sp);
						GrabUtils.setValue(matcher.group(2), "city", sp);
					}
				}
			}
			else if (sibling.nodeName().equals("a")) {
				if (sibling.hasClass("txt_marked_head")) {
					GrabUtils.setValue(sibling.attr("href"), "homepage", sp);
				}
				else if ("#".equals(sibling.attr("href"))) {
					GrabUtils.setValue(sibling.attr("onclick"), "mail", sp);
				}
			}
		}
	}

	@Test
	public void itShouldPopulatePhone() throws Exception {
		Document document = Jsoup.parse(TABLE2);
		Elements elementsByClass = document.getElementsByTag("table");
		ServiceProvider sp = new ServiceProvider();
		populatePhone(sp, elementsByClass.first());
		assertEquals("+49 (0) 40/5118051", sp.getPhone());
	}

	public static void populatePhone(ServiceProvider sp, Element element) {
		String value = element.text();
		Matcher matcher = PHONE_PATTERN.matcher(value);
		if (matcher.matches()) {
			GrabUtils.setValue(matcher.group(1), "phone", sp);
		}
	}
}
